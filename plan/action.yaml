name: plan
description: plan
inputs:
  github_token:
    description: "GitHub Access Token"
    required: false
    default: ${{ github.token }}

  securefix_action_app_id:
    description: |
      GitHub App ID for Securefix Action
      issues:write
    required: false
  securefix_action_app_private_key:
    description: |
      GitHub App Private Key for Securefix Action
    required: false
outputs:
  plan_binary_path:
    description: "Path to the plan binary file"
    value: ${{ steps.main.outputs.plan_binary }}
  plan_json_path:
    description: "Path to the plan json file"
    value: ${{ steps.main.outputs.plan_json }}
  detailed_exitcode:
    description: Detailed exit code of `terraform plan`
    value: ${{ steps.main.outputs.detailed_exitcode }}
  plan_binary_artifact_name:
    description: GitHub Artifact name for the plan file
    value: ${{steps.main.outputs.plan_binary_artifact_name}}
  plan_binary_artifact_path:
    description: GitHub Artifact path for the plan file
    value: ${{steps.main.outputs.plan_binary_artifact_path}}
  plan_json_artifact_name:
    description: GitHub Artifact name for the plan json
    value: ${{steps.main.outputs.plan_json}}
  plan_json_artifact_path:
    description: GitHub Artifact path for the plan json
    value: ${{steps.main.outputs.plan_json}}
  skipped:
    description: Whether the terraform plan was skipped
    value: ${{ steps.main.outputs.skipped }}
runs:
  using: composite
  steps:
    - uses: suzuki-shunsuke/tfaction@main
      id: main
      with:
        action: plan
        github_token: ${{inputs.github_token}}
        securefix_action_app_id: ${{inputs.securefix_action_app_id}}
        securefix_action_app_private_key: ${{inputs.securefix_action_app_private_key}}
