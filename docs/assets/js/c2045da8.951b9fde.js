"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[8396],{7710(e,t,a){a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>l,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"unreleased/update-pr-branch","title":"Automatic PR Branch Updates","description":"tfaction automatically updates PR branches. There are two types of updates.","source":"@site/docs/unreleased/update-pr-branch.md","sourceDirName":"unreleased","slug":"/unreleased/update-pr-branch","permalink":"/tfaction/docs/unreleased/update-pr-branch","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/unreleased/update-pr-branch.md","tags":[],"version":"current","sidebarPosition":1100,"frontMatter":{"sidebar_position":1100},"sidebar":"tutorialSidebar","previous":{"title":"Follow-up PR","permalink":"/tfaction/docs/unreleased/follow-up-pr"},"next":{"title":"Scaffolding Root Modules and Modules from Templates","permalink":"/tfaction/docs/unreleased/scaffold-working-directory"}}');var r=a(4848),i=a(8453);const o={sidebar_position:1100},s="Automatic PR Branch Updates",d={},c=[{value:"1. Automatic Update After Apply",id:"1-automatic-update-after-apply",level:2},{value:"2. Automatic Update During PR CI",id:"2-automatic-update-during-pr-ci",level:2}];function u(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"automatic-pr-branch-updates",children:"Automatic PR Branch Updates"})}),"\n",(0,r.jsx)(t.p,{children:"tfaction automatically updates PR branches. There are two types of updates."}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"After running terraform apply on the default branch, PRs that modify the same root module are automatically updated."}),"\n",(0,r.jsx)(t.li,{children:"When CI runs on a PR, the PR branch is automatically updated if it is behind the base branch."}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"1-automatic-update-after-apply",children:"1. Automatic Update After Apply"}),"\n",(0,r.jsx)(t.p,{children:"When terraform apply is executed for a root module, PRs that modify the same root module need to be updated and have terraform plan re-run.\nOtherwise, reviews based on an outdated plan are unreliable, and the plan file in GitHub Artifacts becomes stale, causing apply to fail even if the PR is merged."}),"\n",(0,r.jsx)(t.p,{children:"By running the update-pr-branch action after the apply action, you can automate this update."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- name: Update related PR branches\n  uses: suzuki-shunsuke/tfaction@latest\n  if: always()\n  with:\n    action: update-pr-branch\n    github_token: ${{ steps.token.outputs.token }}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If you do not want automatic updates, simply do not run the update-pr-branch action. However, as mentioned above, updating before merging is necessary, so this is not recommended.\nYou can also add the ",(0,r.jsx)(t.code,{children:"tfaction:disable-auto-update"})," label to a PR to prevent that PR from being automatically updated."]}),"\n",(0,r.jsx)(t.h2,{id:"2-automatic-update-during-pr-ci",children:"2. Automatic Update During PR CI"}),"\n",(0,r.jsxs)(t.p,{children:["When CI runs on a PR, the ",(0,r.jsx)(t.code,{children:"setup"})," action compares the feature branch with the base branch and automatically updates the feature branch if it is behind.\nThe update is triggered when either of the following conditions is met:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Files under the root module have been updated on the base branch."}),"\n",(0,r.jsxs)(t.li,{children:["300 or more files have been updated on the base branch.","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Due to a limitation of GitHub's Compare Two Commits API, which can only return diffs for up to 300 files, there is a possibility that files under the root module were updated when the total exceeds 300."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Unlike type 1, this feature cannot currently be disabled.\nThis is because type 1 has the drawback of unnecessarily updating stale PRs, whereas type 2 only triggers when CI is actually run on a PR."})]})}function l(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453(e,t,a){a.d(t,{R:()=>o,x:()=>s});var n=a(6540);const r={},i=n.createContext(r);function o(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);