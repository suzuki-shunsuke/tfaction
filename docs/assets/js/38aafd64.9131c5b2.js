"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[6788],{2059(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"unreleased/v2-release-note","title":"v2 Release Note","description":"Summary","source":"@site/docs/unreleased/v2-release-note.md","sourceDirName":"unreleased","slug":"/unreleased/v2-release-note","permalink":"/tfaction/docs/unreleased/v2-release-note","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/unreleased/v2-release-note.md","tags":[],"version":"current","sidebarPosition":3600,"frontMatter":{"sidebar_position":3600},"sidebar":"tutorialSidebar","previous":{"title":"Safe Apply Using Plan Files","permalink":"/tfaction/docs/unreleased/plan-file"},"next":{"title":"v2 Upgrade Guide","permalink":"/tfaction/docs/unreleased/v2-upgrade-guide"}}');var r=i(4848),a=i(8453);const o={sidebar_position:3600},s="v2 Release Note",l={},d=[{value:"Summary",id:"summary",level:2},{value:"Improvements",id:"improvements",level:2},{value:"Performance Improvements",id:"performance-improvements",level:3},{value:"Improved Maintainability",id:"improved-maintainability",level:3},{value:"Support for Customizing Reviewdog Configuration",id:"support-for-customizing-reviewdog-configuration",level:3},{value:"Official Release of replace_target",id:"official-release-of-replace_target",level:3},{value:"Automatic aqua Installation",id:"automatic-aqua-installation",level:3},{value:"Skipping terraform plan and apply on a Per-File Basis",id:"skipping-terraform-plan-and-apply-on-a-per-file-basis",level:3},{value:"Testing Workflows When Workflow Files Are Changed",id:"testing-workflows-when-workflow-files-are-changed",level:3},{value:"Bug Fixes",id:"bug-fixes",level:2},{value:"Properly Catch Exceptions in Node.js",id:"properly-catch-exceptions-in-nodejs",level:3},{value:"Support for Terragrunt v0.88.0 and Later",id:"support-for-terragrunt-v0880-and-later",level:3},{value:"Fix Failure to Parse terragrunt plan and apply Results",id:"fix-failure-to-parse-terragrunt-plan-and-apply-results",level:3},{value:"Others",id:"others",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"v2-release-note",children:"v2 Release Note"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:["tfaction v2 includes various breaking changes, and all users need to modify their code.\nPlease refer to the upgrade guide for details.\ntfaction, which was previously a collection of many actions, has been entirely rewritten as a single JavaScript Action, where functionality such as plan, apply, and test is selected via the ",(0,r.jsx)(n.code,{children:"action"})," input.\nThis significantly improves both performance and maintainability.\nThe release also includes feature additions such as the introduction of a template engine, support for Reviewdog customization, and the official release of the target replacement feature."]}),"\n",(0,r.jsx)(n.h2,{id:"improvements",children:"Improvements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Performance improvements"}),"\n",(0,r.jsx)(n.li,{children:"Improved maintainability"}),"\n",(0,r.jsx)(n.li,{children:"Support for customizing Reviewdog configuration"}),"\n",(0,r.jsx)(n.li,{children:"Official release of replace_target"}),"\n",(0,r.jsx)(n.li,{children:"Automatic aqua installation"}),"\n",(0,r.jsx)(n.li,{children:"Support for customizing PR title, body, and comment in scaffold"}),"\n",(0,r.jsxs)(n.li,{children:["Glob support in target_groups.working_directory","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enables more flexible configuration"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"tflint --fix auto-correction enabled by default"}),"\n",(0,r.jsxs)(n.li,{children:["Added ",(0,r.jsx)(n.code,{children:"github_token_for_github_provider"})," input for passing a GitHub Access Token for the GitHub Provider"]}),"\n",(0,r.jsx)(n.li,{children:"Automatic PR branch update when root modules are changed on the base branch compared to the feature branch"}),"\n",(0,r.jsx)(n.li,{children:"Added ability to skip terraform plan and apply on a per-file basis"}),"\n",(0,r.jsx)(n.li,{children:"Added ability to test workflows when workflow files are changed"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance-improvements",children:"Performance Improvements"}),"\n",(0,r.jsxs)(n.p,{children:["Previously, all ",(0,r.jsx)(n.code,{children:"suzuki-shunsuke/tfaction/*"})," actions except ",(0,r.jsx)(n.code,{children:"suzuki-shunsuke/tfaction/js"})," were Composite Actions.\nIn v2, they have been consolidated into a single JavaScript Action: ",(0,r.jsx)(n.code,{children:"suzuki-shunsuke/tfaction"}),".\nThis significantly reduces the time spent downloading actions and greatly shortens the processing time of the ",(0,r.jsx)(n.code,{children:"Set up job"})," step, which runs at the beginning of every GitHub Actions job.\nWhile results vary by environment, we observed a reduction of approximately 20 to 40 seconds in our environment.\nAdditionally, rewriting everything as a single JavaScript Action eliminates the overhead between Composite Action steps and provides minor performance improvements by replacing external command execution with JavaScript."]}),"\n",(0,r.jsxs)(n.p,{children:["The removal of AWS and Google Cloud authentication is also related to performance improvements.\nDue to how GitHub Actions works, actions are downloaded during ",(0,r.jsx)(n.code,{children:"Set up job"})," even if the step running the action is skipped.\nThis means that even when AWS or Google Cloud authentication is not needed, the action is still downloaded, which is wasteful.\nEmbedding the functionality of ",(0,r.jsx)(n.code,{children:"aws-actions/configure-aws-credentials"})," and ",(0,r.jsx)(n.code,{children:"google-github-actions/auth"})," into tfaction's TypeScript would avoid the download, but we decided against it due to the maintenance burden.\nInstead, users now run these actions themselves as needed.\nThis also allows more flexible authentication handling than before."]}),"\n",(0,r.jsx)(n.h3,{id:"improved-maintainability",children:"Improved Maintainability"}),"\n",(0,r.jsx)(n.p,{children:"Rewriting all code in TypeScript has improved maintainability.\nPreviously, with the Composite Action implementation, data was passed between steps using inputs/outputs and environment variables.\nHowever, the type system for these interfaces is extremely limited.\nOnly the string type is supported, requiring data serialization, and it is difficult to catch mistakes in input/output names or types before execution.\nAdditionally, there are size limits on data, requiring file-based workarounds for large payloads."}),"\n",(0,r.jsx)(n.p,{children:"In contrast, with everything written in TypeScript, the powerful type system and editor integration make it easy to catch mistakes, provide code completion, and write unit tests."}),"\n",(0,r.jsx)(n.h3,{id:"support-for-customizing-reviewdog-configuration",children:"Support for Customizing Reviewdog Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Results from trivy and tflint are reported via reviewdog, and the configuration can now be customized.\nThe most significant change is that ",(0,r.jsx)(n.code,{children:"-filter-mode"})," is now configurable.\nPreviously, ",(0,r.jsx)(n.code,{children:"--filter-mode nofilter"})," was hard-coded, meaning code not changed in the PR was also included in the results.\nBy setting ",(0,r.jsx)(n.code,{children:"--filter-mode"})," to ",(0,r.jsx)(n.code,{children:"added"}),", only code changed in the PR is targeted.\nThere are trade-offs to both options, but in cases where ",(0,r.jsx)(n.code,{children:"nofilter"})," makes adoption difficult, ",(0,r.jsx)(n.code,{children:"added"})," may be preferable."]}),"\n",(0,r.jsx)(n.h3,{id:"official-release-of-replace_target",children:"Official Release of replace_target"}),"\n",(0,r.jsx)(n.p,{children:"replace_target is a feature that provides more flexible conversion from working directory to target using regular expressions.\nThis feature actually existed before, but since tfaction-go did not support it, it was treated as an unofficial feature and was not documented."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'replace:\n  patterns:\n    # Replace /services/ to / : e.g. github/services/foo => github/foo\n    - regexp: /services/\n      replace: /\n    # Replace /production$ to /prod\n    - regexp: /production$\n      replace: /prod\n    # Remove the prefix `google-` : e.g. foo/google-users/production => foo/users/prod\n    - regexp: /google-(.*)/\n      replace: "/$1/"\n      flags: g\n'})}),"\n",(0,r.jsx)(n.h3,{id:"automatic-aqua-installation",children:"Automatic aqua Installation"}),"\n",(0,r.jsx)(n.p,{children:"tfaction now installs aqua automatically, so users no longer need to install it themselves.\nHowever, the aqua version is hard-coded and cannot be changed.\nThis makes it easier to adopt tfaction even if you are not already using aqua."}),"\n",(0,r.jsx)(n.h3,{id:"skipping-terraform-plan-and-apply-on-a-per-file-basis",children:"Skipping terraform plan and apply on a Per-File Basis"}),"\n",(0,r.jsx)(n.p,{children:"Added the ability to skip terraform plan and apply when editing files that do not affect the results.\nFor example, you can skip terraform plan and apply for PRs that only modify README.md."}),"\n",(0,r.jsx)(n.h3,{id:"testing-workflows-when-workflow-files-are-changed",children:"Testing Workflows When Workflow Files Are Changed"}),"\n",(0,r.jsxs)(n.p,{children:["When a GitHub Actions Workflow that runs plan or apply is modified, even if no working directories are changed in the PR, a specified working directory is added to the ",(0,r.jsx)(n.code,{children:"list-targets"})," output so that plan and apply are executed, allowing you to verify that the workflow functions correctly.\nThis prevents situations where plan breaks due to workflow modifications and ensures that apply failures are caught early.\nIt eliminates the need to manually modify files in an arbitrary directory just to trigger plan and apply for testing."]}),"\n",(0,r.jsx)(n.h2,{id:"bug-fixes",children:"Bug Fixes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Properly catch exceptions in Node.js"}),"\n",(0,r.jsx)(n.li,{children:"Support for Terragrunt v0.88.0 and later"}),"\n",(0,r.jsx)(n.li,{children:"Fix failure to parse terragrunt plan and apply results"}),"\n",(0,r.jsx)(n.li,{children:"Fix incorrect behavior when tfaction-root.yaml is in a subdirectory"}),"\n",(0,r.jsx)(n.li,{children:"Fix incorrect behavior when the repository is checked out to a location other than github.workspace"}),"\n",(0,r.jsxs)(n.li,{children:["Fix inability to set ",(0,r.jsx)(n.code,{children:"minimum_detection_interval"})," to 0 in drift detection"]}),"\n",(0,r.jsx)(n.li,{children:"Fix list-targets matching template directories"}),"\n",(0,r.jsxs)(n.li,{children:["Fix inability to place a root module at the repository root","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Previously, an empty TFACTION_TARGET caused a failure, preventing root modules from being placed at the repository root"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Fix conftest running even when destroy is enabled in tfaction.yaml"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"properly-catch-exceptions-in-nodejs",children:"Properly Catch Exceptions in Node.js"}),"\n",(0,r.jsx)(n.p,{children:"Fixed a bug where exceptions were not properly caught and were output as-is."}),"\n",(0,r.jsx)(n.h3,{id:"support-for-terragrunt-v0880-and-later",children:"Support for Terragrunt v0.88.0 and Later"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/suzuki-shunsuke/tfaction/issues/3148",children:"https://github.com/suzuki-shunsuke/tfaction/issues/3148"})}),"\n",(0,r.jsxs)(n.p,{children:["Fixed an issue where tfaction did not work with Terragrunt v0.88.0.\nIt should also work with older versions of Terragrunt prior to v0.73.0 that do not support ",(0,r.jsx)(n.code,{children:"terragrunt run"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"fix-failure-to-parse-terragrunt-plan-and-apply-results",children:"Fix Failure to Parse terragrunt plan and apply Results"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://suzuki-shunsuke.github.io/tfcmt/terragrunt",children:"https://suzuki-shunsuke.github.io/tfcmt/terragrunt"})}),"\n",(0,r.jsx)(n.p,{children:"Before:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://storage.googleapis.com/zenn-user-upload/f91a5ff415ef-20260112.png",alt:""})}),"\n",(0,r.jsx)(n.p,{children:"After:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://storage.googleapis.com/zenn-user-upload/887690246667-20260112.png",alt:""})}),"\n",(0,r.jsxs)(n.p,{children:["Previously, users could work around this by setting the environment variable ",(0,r.jsx)(n.code,{children:"TERRAGRUNT_LOG_DISABLE"})," to ",(0,r.jsx)(n.code,{children:"true"}),", but tfaction now sets this environment variable automatically."]}),"\n",(0,r.jsx)(n.h2,{id:"others",children:"Others"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Changed slashes ",(0,r.jsx)(n.code,{children:"/"})," to underscores ",(0,r.jsx)(n.code,{children:"__"})," in created branch names","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Using ",(0,r.jsx)(n.code,{children:"/"})," in branch names can cause issues, so this was changed"]}),"\n"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,n,i){i.d(n,{R:()=>o,x:()=>s});var t=i(6540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);