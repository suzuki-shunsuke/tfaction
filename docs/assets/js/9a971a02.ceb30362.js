"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[9897],{7946(e,n,t){t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>m});const s=JSON.parse('{"id":"unreleased/hide-old-comment","title":"Hide Old PR Comments","description":"In the workflow built in Getting Started, tfcmt posts comments on pull requests.","source":"@site/docs/unreleased/hide-old-comment.md","sourceDirName":"unreleased","slug":"/unreleased/hide-old-comment","permalink":"/tfaction/docs/unreleased/hide-old-comment","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/unreleased/hide-old-comment.md","tags":[],"version":"current","sidebarPosition":300,"frontMatter":{"sidebar_position":300},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started","permalink":"/tfaction/docs/unreleased/getting-started"},"next":{"title":"JSON Schema for Configuration Files","permalink":"/tfaction/docs/unreleased/json-schema"}}');var i=t(4848),o=t(8453);const a={sidebar_position:300},c="Hide Old PR Comments",r={},m=[{value:"github-comment hide",id:"github-comment-hide",level:2},{value:"tfcmt plan -patch",id:"tfcmt-plan--patch",level:2}];function l(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hide-old-pr-comments",children:"Hide Old PR Comments"})}),"\n",(0,i.jsxs)(n.p,{children:["In the workflow built in ",(0,i.jsx)(n.a,{href:"getting-started",children:"Getting Started"}),", tfcmt posts comments on pull requests.",(0,i.jsx)(n.br,{}),"\n","However, one issue is that old comments remain and continue to accumulate."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://storage.googleapis.com/zenn-user-upload/0082918de91c-20260208.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"There are two solutions:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Hide old comments using ",(0,i.jsx)(n.a,{href:"https://suzuki-shunsuke.github.io/github-comment/hide/",children:"github-comment hide"})]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.a,{href:"https://suzuki-shunsuke.github.io/tfcmt/plan-patch/",children:"tfcmt plan -patch"})," to update existing comments instead of creating new ones"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"We recommend option 1."}),"\n",(0,i.jsx)(n.h2,{id:"github-comment-hide",children:"github-comment hide"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"github-comment"})," to ",(0,i.jsx)(n.code,{children:"aqua.yaml"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"aqua g -i suzuki-shunsuke/github-comment\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Install ",(0,i.jsx)(n.code,{children:"github-comment"})," via aqua in GitHub Actions and run ",(0,i.jsx)(n.code,{children:"github-comment hide"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"packages:\n  - name: suzuki-shunsuke/github-comment@v6.4.1\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'---\n# yaml-language-server: $schema=https://raw.githubusercontent.com/suzuki-shunsuke/github-comment/v6.3.1/json-schema/github-comment.json\n# https://github.com/suzuki-shunsuke/github-comment\nhide:\n  default: |\n    Comment.HasMeta && Comment.Meta.SHA1 != Commit.SHA1 && ! (Comment.Meta.Program == "tfcmt" && Comment.Meta.Command == "apply")\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"on: pull_request\njobs:\n  hide-comment:\n    timeout-minutes: 10\n    runs-on: ubuntu-24.04\n    permissions:\n      contents: read\n    steps:\n      - name: Checkout Repository\n        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1\n        with:\n          persist-credentials: false\n\n      - name: Install aqua\n        uses: aquaproj/aqua-installer@11dd79b4e498d471a9385aa9fb7f62bb5f52a73c # v4.0.4\n        with:\n          aqua_version: v2.56.6\n\n      - name: Create GitHub App installation access token\n        uses: actions/create-github-app-token@29824e69f54612133e76f7eaac726eef6c875baf # v2.2.1\n        id: token\n        with:\n          app-id: ${{ vars.APP_ID }}\n          private-key: ${{ secrets.PRIVATE_KEY }}\n          permission-pull-requests: write\n\n      - name: Hide old comments\n        run: github-comment hide\n        env:\n          GITHUB_TOKEN: ${{ steps.token.outputs.token }}\n"})}),"\n",(0,i.jsx)(n.p,{children:"With this setup, old comments will be hidden."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://storage.googleapis.com/zenn-user-upload/bd7b16acc7af-20260208.png",alt:""})}),"\n",(0,i.jsx)(n.h2,{id:"tfcmt-plan--patch",children:"tfcmt plan -patch"}),"\n",(0,i.jsx)(n.p,{children:"Create a tfcmt configuration file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# yaml-language-server: $schema=https://raw.githubusercontent.com/suzuki-shunsuke/tfcmt/v4.14.1/json-schema/tfcmt.json\n# https://github.com/suzuki-shunsuke/tfcmt\nplan_patch: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This causes ",(0,i.jsx)(n.code,{children:"terraform plan"})," and ",(0,i.jsx)(n.code,{children:"apply"})," comments to be updated instead of creating new ones."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://storage.googleapis.com/zenn-user-upload/c4224657d761-20260208.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"However, tfaction does not only post comments via tfcmt.\nOlder comments created by tools other than tfcmt will still remain."}),"\n",(0,i.jsxs)(n.p,{children:["Therefore, it is recommended to combine this with ",(0,i.jsx)(n.code,{children:"github-comment hide"}),".\nThat said, if you do so, you might conclude that using only ",(0,i.jsx)(n.code,{children:"github-comment hide"})," is sufficient."]}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'---\n# yaml-language-server: $schema=https://raw.githubusercontent.com/suzuki-shunsuke/github-comment/v6.3.1/json-schema/github-comment.json\n# https://github.com/suzuki-shunsuke/github-comment\nhide:\n  # Do not hide comments created by tfcmt\n  default: |\n    Comment.HasMeta && Comment.Meta.SHA1 != Commit.SHA1 && Comment.Meta.Program != "tfcmt"\n'})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>c});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);