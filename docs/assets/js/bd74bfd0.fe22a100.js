"use strict";(self.webpackChunktfaction=self.webpackChunktfaction||[]).push([[436],{2879:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var n=r(4848),i=r(5680);const a={sidebar_position:80},o="Apply safely with Terraform Plan File",l={id:"feature/plan-file",title:"Apply safely with Terraform Plan File",description:"Apply safely with Terraform Plan file created by Pull Request.",source:"@site/docs/feature/plan-file.md",sourceDirName:"feature",slug:"/feature/plan-file",permalink:"/tfaction/docs/feature/plan-file",draft:!1,unlisted:!1,editUrl:"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/feature/plan-file.md",tags:[],version:"current",sidebarPosition:80,frontMatter:{sidebar_position:80},sidebar:"tutorialSidebar",previous:{title:"Notify the result of terraform plan and apply with tfcmt",permalink:"/tfaction/docs/feature/tfcmt"},next:{title:"Automatically update related pull requests when the remote state is updated",permalink:"/tfaction/docs/feature/auto-update-related-prs"}},s={},c=[{value:"tfaction v0.7.0 migrated plan files to GitHub Actions&#39; Artifacts",id:"tfaction-v070-migrated-plan-files-to-github-actions-artifacts",level:2}];function f(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",...(0,i.RP)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"apply-safely-with-terraform-plan-file",children:"Apply safely with Terraform Plan File"}),"\n",(0,n.jsx)(t.p,{children:"Apply safely with Terraform Plan file created by Pull Request."}),"\n",(0,n.jsx)(t.p,{children:"tfaction's Workflow"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"terraform plan"})," is run in the Pull Request CI"]}),"\n",(0,n.jsx)(t.li,{children:"you check the plan result"}),"\n",(0,n.jsx)(t.li,{children:"apply the result by merging the pull request"}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["In this case, it is important to apply the same result as the result of ",(0,n.jsx)(t.code,{children:"terraform plan"})," of the pull request CI.\nOtherwise, unexpected changes may be applied."]}),"\n",(0,n.jsxs)(t.p,{children:["tfaction stores the latest Terraform Plan files to GitHub Actions' Artifacts per pull request and working directory, and downloading them when ",(0,n.jsx)(t.code,{children:"terraform apply"})," is run."]}),"\n",(0,n.jsx)(t.h2,{id:"tfaction-v070-migrated-plan-files-to-github-actions-artifacts",children:"tfaction v0.7.0 migrated plan files to GitHub Actions' Artifacts"}),"\n",(0,n.jsxs)(t.p,{children:["tfaction ever stored plan files to S3 or GCS, but tfaction v0.7.0 migrated them to ",(0,n.jsx)(t.a,{href:"https://docs.github.com/en/actions/using-workflows/storing-workflow-data-as-artifacts",children:"GitHub Actions Artifacts"}),".\nBy this change you don't have to create and manage S3 or GCS.\nFurthermore, S3 or GCS had security risks that plan files could be tampered.\nGitHub Actions Artifacts can be uploaded files only in the associated workflow run and can't be tampered from outside of the workflow run."]}),"\n",(0,n.jsx)(t.p,{children:"GitHub Actions Artifacts has the retention period so plan files are removed after the retension period.\nThe default retention period is 90 days, and we think it is enough."})]})}function p(e={}){const{wrapper:t}={...(0,i.RP)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(f,{...e})}):f(e)}},5680:(e,t,r)=>{r.d(t,{RP:()=>c});var n=r(6540);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},f={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(r),d=i,h=u["".concat(s,".").concat(d)]||u[d]||f[d]||a;return r?n.createElement(h,o(o({ref:t},p),{},{components:r})):n.createElement(h,o({ref:t},p))}));p.displayName="MDXCreateElement"}}]);