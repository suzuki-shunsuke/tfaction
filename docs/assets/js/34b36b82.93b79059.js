"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[5941],{2408(e,n,t){t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"unreleased/aws","title":"Configuration for AWS","description":"This page explains the configuration for using the AWS Provider and S3 Backend.","source":"@site/docs/unreleased/aws.md","sourceDirName":"unreleased","slug":"/unreleased/aws","permalink":"/tfaction/docs/unreleased/aws","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/unreleased/aws.md","tags":[],"version":"current","sidebarPosition":1200,"frontMatter":{"sidebar_position":1200},"sidebar":"tutorialSidebar","previous":{"title":"Creating a Root Module from a Template","permalink":"/tfaction/docs/unreleased/scaffold-working-directory"},"next":{"title":"Configuration for Google Cloud","permalink":"/tfaction/docs/unreleased/google-cloud"}}');var s=t(4848),r=t(8453);const a={sidebar_position:1200},i="Configuration for AWS",u={},c=[{value:"IAM Role Configuration",id:"iam-role-configuration",level:2},{value:"Using the Terraform Module",id:"using-the-terraform-module",level:2},{value:"OIDC",id:"oidc",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"configuration-for-aws",children:"Configuration for AWS"})}),"\n",(0,s.jsx)(n.p,{children:"This page explains the configuration for using the AWS Provider and S3 Backend.\nIf you do not use these, you can skip this page."}),"\n",(0,s.jsx)(n.p,{children:"When using these, you need to authenticate before running terraform init."}),"\n",(0,s.jsx)(n.h2,{id:"iam-role-configuration",children:"IAM Role Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Configure the IAM Role to assume in tfaction-root.yaml or tfaction.yaml."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'target_groups:\n  - working_directory: ""\n    aws_region: ap-northeast-1\n    terraform_plan_config:\n      aws_assume_role_arn: arn:aws:iam::000000000000:role/GitHubActions_Terraform_AWS_terraform_plan\n    terraform_apply_config:\n      aws_assume_role_arn: arn:aws:iam::000000000000:role/GitHubActions_Terraform_AWS_terraform_apply\n'})}),"\n",(0,s.jsx)(n.p,{children:"Because you can use separate IAM Roles for terraform plan and apply, you can use a read-only IAM Role for plan and an IAM Role with stronger permissions for apply."}),"\n",(0,s.jsxs)(n.p,{children:["In tfaction v1, the ",(0,s.jsx)(n.code,{children:"setup"})," action executed ",(0,s.jsx)(n.a,{href:"https://github.com/aws-actions/configure-aws-credentials",children:"aws-actions/configure-aws-credentials"}),".\nStarting from v2, it is no longer executed automatically, so you need to run it yourself."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- name: Set up\n  uses: suzuki-shunsuke/tfaction@latest\n  id: setup\n  with:\n    action: setup\n    github_token: ${{steps.generate_token.outputs.token}}\n\n- uses: aws-actions/configure-aws-credentials@61815dcd50bd041e203e49132bacad1fd04d2708 # v5.1.1\n  if: steps.setup.outputs.aws_assume_role_arn != ''\n  with:\n    role-to-assume: ${{ steps.setup.outputs.aws_assume_role_arn }}\n    role-session-name: ${{ steps.setup.outputs.aws_role_session_name }}\n    aws-region: ${{ steps.setup.outputs.aws_region }}\n\n- name: terraform init\n  uses: suzuki-shunsuke/tfaction@latest\n  with:\n    action: terraform-init\n"})}),"\n",(0,s.jsx)(n.h2,{id:"using-the-terraform-module",children:"Using the Terraform Module"}),"\n",(0,s.jsxs)(n.p,{children:["You can use ",(0,s.jsx)(n.a,{href:"https://github.com/suzuki-shunsuke/terraform-aws-tfaction",children:"https://github.com/suzuki-shunsuke/terraform-aws-tfaction"})," to create IAM Roles with the minimum required permissions.\nHowever, using this module is not mandatory."]}),"\n",(0,s.jsx)(n.h2,{id:"oidc",children:"OIDC"}),"\n",(0,s.jsx)(n.p,{children:"You can assume an IAM Role from GitHub Actions using OIDC.\nThis is not directly related to tfaction, so the details are omitted here."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.github.com/en/actions/how-tos/secure-your-work/security-harden-deployments/oidc-in-aws",children:"https://docs.github.com/en/actions/how-tos/secure-your-work/security-harden-deployments/oidc-in-aws"})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>i});var o=t(6540);const s={},r=o.createContext(s);function a(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);