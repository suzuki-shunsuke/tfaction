"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[665],{2577:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"config/github-token","title":"GitHub Access Token","description":"tfaction requires a GitHub Access Token.","source":"@site/docs/config/github-token.md","sourceDirName":"config","slug":"/config/github-token","permalink":"/tfaction/docs/config/github-token","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/config/github-token.md","tags":[],"version":"current","sidebarPosition":250,"frontMatter":{"sidebar_position":250},"sidebar":"tutorialSidebar","previous":{"title":"tfaction.yaml","permalink":"/tfaction/docs/config/tfaction-yaml"},"next":{"title":"aqua.yaml","permalink":"/tfaction/docs/config/aqua"}}');var n=s(4848),o=s(8453);const c={sidebar_position:250},r="GitHub Access Token",l={},a=[{value:"Use GitHub App instead of the secret <code>GITHUB_TOKEN</code>",id:"use-github-app-instead-of-the-secret-github_token",level:2},{value:"Required permissions of the secret <code>GITHUB_TOKEN</code>",id:"required-permissions-of-the-secret-github_token",level:2},{value:"Required permissions of GitHub Access token",id:"required-permissions-of-github-access-token",level:2},{value:"Refer to tfaction-example",id:"refer-to-tfaction-example",level:2}];function u(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"github-access-token",children:"GitHub Access Token"})}),"\n",(0,n.jsx)(t.p,{children:"tfaction requires a GitHub Access Token."}),"\n",(0,n.jsxs)(t.h2,{id:"use-github-app-instead-of-the-secret-github_token",children:["Use GitHub App instead of the secret ",(0,n.jsx)(t.code,{children:"GITHUB_TOKEN"})]}),"\n",(0,n.jsxs)(t.p,{children:["Some actions pushes commits to pull requests or create new pull requests, but the secret ",(0,n.jsx)(t.code,{children:"GITHUB_TOKEN"})," doesn't trigger a GitHub Actions workflow run."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://docs.github.com/en/actions/security-guides/automatic-token-authentication#using-the-github_token-in-a-workflow",children:"https://docs.github.com/en/actions/security-guides/automatic-token-authentication#using-the-github_token-in-a-workflow"})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"When you use the repository's GITHUB_TOKEN to perform tasks, events triggered by the GITHUB_TOKEN will not create a new workflow run."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"So we recommend issuing an access token from a GitHub App.\nThere are some GitHub Actions to issue an access token from a GitHub App."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/tibdex/github-app-token",children:"https://github.com/tibdex/github-app-token"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/actions/create-github-app-token",children:"https://github.com/actions/create-github-app-token"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/cybozu/octoken-action",children:"https://github.com/cybozu/octoken-action"})}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["To create a GitHub App, please see ",(0,n.jsx)(t.a,{href:"https://docs.github.com/en/developers/apps/building-github-apps/creating-a-github-app",children:"the official document"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"You can also use a personal access token, but we recommend GitHub App in terms of security."}),"\n",(0,n.jsxs)(t.h2,{id:"required-permissions-of-the-secret-github_token",children:["Required permissions of the secret ",(0,n.jsx)(t.code,{children:"GITHUB_TOKEN"})]}),"\n",(0,n.jsxs)(t.p,{children:["If you use ",(0,n.jsx)(t.a,{href:"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect",children:"OIDC"}),", probably the permission ",(0,n.jsx)(t.code,{children:"id-token: write"})," is required."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"permissions:\n  id-token: write\n"})}),"\n",(0,n.jsx)(t.h2,{id:"required-permissions-of-github-access-token",children:"Required permissions of GitHub Access token"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"contents: write"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Create commits and branches"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"pull_requests: write"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Open pull requests"}),"\n",(0,n.jsx)(t.li,{children:"Post comments to pull requests"}),"\n",(0,n.jsx)(t.li,{children:"Add labels to pull requests"}),"\n",(0,n.jsx)(t.li,{children:"Review pull requests by reviewdog"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"issues: read"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"/tfaction/docs/feature/auto-update-related-prs",children:"Search related pull requests with labels"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"gh pr list"}),"'s ",(0,n.jsx)(t.code,{children:"-l"})," option requires the permission"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"issues: write"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Create labels"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"actions: read"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/tfaction/docs/feature/plan-file",children:"Download plan files from GitHub Artifacts"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"refer-to-tfaction-example",children:"Refer to tfaction-example"}),"\n",(0,n.jsxs)(t.p,{children:["About the permission, please see ",(0,n.jsx)(t.a,{href:"https://github.com/suzuki-shunsuke/tfaction-example/tree/main/.github/workflows",children:"tfaction-example"})," too."]}),"\n",(0,n.jsx)(t.p,{children:"tfaction composes of multiple actions, and each action requires different permissions.\nSo in terms of the least privilege, you should issue a token per action.\nFrom the example, you can see what permissions each action requires."}),"\n",(0,n.jsx)(t.p,{children:"e.g."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://github.com/suzuki-shunsuke/tfaction-example/blob/9e353a7b1938715a0b1238342720d3d2011f35a3/.github/workflows/apply.yaml#L134-L155",children:"https://github.com/suzuki-shunsuke/tfaction-example/blob/9e353a7b1938715a0b1238342720d3d2011f35a3/.github/workflows/apply.yaml#L134-L155"})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>c,x:()=>r});var i=s(6540);const n={},o=i.createContext(n);function c(e){const t=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:c(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);