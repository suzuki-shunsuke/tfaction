"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[4263],{8319(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"config/secret","title":"Secrets Management","description":"tfaction supports two types of secrets management.","source":"@site/docs/config/secret.md","sourceDirName":"config","slug":"/config/secret","permalink":"/tfaction/docs/config/secret","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/config/secret.md","tags":[],"version":"current","sidebarPosition":300,"frontMatter":{"sidebar_position":300},"sidebar":"tutorialSidebar","previous":{"title":"aqua.yaml","permalink":"/tfaction/docs/config/aqua"},"next":{"title":"Set Terraform CLI options with the environment variable","permalink":"/tfaction/docs/config/terraform-cli-options"}}');var r=s(4848),a=s(8453);const o={sidebar_position:300},i="Secrets Management",c={},l=[{value:"GitHub Secrets",id:"github-secrets",level:3},{value:"AWS Secrets Manager",id:"aws-secrets-manager",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"secrets-management",children:"Secrets Management"})}),"\n",(0,r.jsx)(n.p,{children:"tfaction supports two types of secrets management."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.github.com/en/actions/security-guides/encrypted-secrets",children:"GitHub Secrets"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://aws.amazon.com/secrets-manager/",children:"AWS Secrets Manager"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"github-secrets",children:"GitHub Secrets"}),"\n",(0,r.jsxs)(n.p,{children:["You can export GitHub Secrets as environment variables with ",(0,r.jsx)(n.a,{href:"https://github.com/suzuki-shunsuke/tfaction/tree/main/export-secrets",children:"export-secrets"})," Action."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"- uses: suzuki-shunsuke/tfaction/export-secrets@main\n  with:\n    secrets: ${{ toJSON(secrets) }}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Target Group Configuration"}),"\n",(0,r.jsx)(n.p,{children:"e.g."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"target_groups:\n  - working_directory: atlas/staging/\n    # ...\n    secrets:\n      # export the secret `ATLAS_API_KEY_STAGING` as the environment variable `ATLAS_API_KEY`\n      - env_name: ATLAS_API_KEY\n        secret_name: ATLAS_API_KEY_STAGING\n"})}),"\n",(0,r.jsx)(n.p,{children:"Job Configuration"}),"\n",(0,r.jsx)(n.p,{children:"e.g."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"target_groups:\n  - working_directory: atlas/staging/\n    # ...\n    terraform_plan_config:\n      # ...\n      secrets:\n        - env_name: ATLAS_API_KEY\n          secret_name: ATLAS_API_KEY_STAGING_READ_ONLY\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:"If secrets aren't set as you expect, please check if secrets are passed to this action properly.\nIf you use reusable workflows, maybe secrets aren't passed to the reusable workflow.\nIf so, please pass secrets properly."}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.github.com/en/actions/using-workflows/reusing-workflows#passing-inputs-and-secrets-to-a-reusable-workflow",children:"https://docs.github.com/en/actions/using-workflows/reusing-workflows#passing-inputs-and-secrets-to-a-reusable-workflow"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsecrets",children:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsecrets"})}),"\n"]}),(0,r.jsx)(n.p,{children:"From tfaction v1.3.1, the action outputs the list of secrets passed to the action as a log.\nSo please check the log."}),(0,r.jsx)(n.p,{children:"e.g."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Run suzuki-shunsuke/tfaction/export-secrets@v1.3.1\nThe list of secret names passed to the action: gh_app_id, gh_app_private_Key, github_token\nError: "secret is not found: FASTLY_API_KEY"\n'})})]}),"\n",(0,r.jsx)(n.h3,{id:"aws-secrets-manager",children:"AWS Secrets Manager"}),"\n",(0,r.jsxs)(n.p,{children:["You can output AWS Secrets Manager's Secrets with the ",(0,r.jsx)(n.code,{children:"output-aws-secrets-manager"})," action.\nSecrets are output as a JSON map via the ",(0,r.jsx)(n.code,{children:"secrets"})," output, so they are only accessible to steps that explicitly reference the output."]}),"\n",(0,r.jsx)(n.p,{children:"Target Group Configuration"}),"\n",(0,r.jsx)(n.p,{children:"e.g."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"target_groups:\n  - working_directory: foo/\n    # ...\n    aws_secrets_manager:\n      - secret_id: foo\n        envs:\n          - env_name: FOO_API_KEY\n        # if `secret_key` isn't specified, the whole secret value is exported\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"target_groups:\n  - working_directory: atlas/\n    # ...\n    aws_secrets_manager:\n      - secret_id: atlas\n        envs:\n          - env_name: ATLAS_API_PUBLIC_KEY\n            secret_key: public_key\n          - env_name: ATLAS_API_PRIVATE_KEY\n            secret_key: private_key\n            # if `secret_key` is specified, the secret value is treated as JSON and the specified key is exported\n"})}),"\n",(0,r.jsx)(n.p,{children:"Job Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"target_groups:\n  - working_directory: atlas/\n    # ...\n    terraform_plan_config:\n      # ...\n      aws_secrets_manager:\n        - secret_id: atlas\n          envs:\n            - env_name: ATLAS_API_PUBLIC_KEY\n              secret_key: public_key\n            - env_name: ATLAS_API_PRIVATE_KEY\n              secret_key: private_key\n"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>i});var t=s(6540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);