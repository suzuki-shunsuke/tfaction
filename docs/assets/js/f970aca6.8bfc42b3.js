"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[9992],{9738(e,t,n){n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"unreleased/csm-actions","title":"Secure Commits and PR Creation with CSM Actions","description":"By default, tfaction uses the github_token input when creating commits and PRs.","source":"@site/docs/unreleased/csm-actions.md","sourceDirName":"unreleased","slug":"/unreleased/csm-actions","permalink":"/tfaction/docs/unreleased/csm-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/unreleased/csm-actions.md","tags":[],"version":"current","sidebarPosition":2300,"frontMatter":{"sidebar_position":2300},"sidebar":"tutorialSidebar","previous":{"title":"Code Generation with terraform plan -generate-config-out","permalink":"/tfaction/docs/unreleased/terraform-plan-generate-config-out"},"next":{"title":"Using OpenTofu or Terragrunt","permalink":"/tfaction/docs/unreleased/opentofu-terragrunt"}}');var i=n(4848),o=n(8453);const r={sidebar_position:2300},c="Secure Commits and PR Creation with CSM Actions",a={},l=[];function u(e){const t={a:"a",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"secure-commits-and-pr-creation-with-csm-actions",children:"Secure Commits and PR Creation with CSM Actions"})}),"\n",(0,i.jsxs)(t.p,{children:["By default, tfaction uses the ",(0,i.jsx)(t.code,{children:"github_token"})," input when creating commits and PRs.\nTherefore, ",(0,i.jsx)(t.code,{children:"github_token"})," requires ",(0,i.jsx)(t.code,{children:"contents:write"})," permission.\nThis access token can generally be used from the CI of any pull request in the repository where tfaction runs.\nMisusing this access token could allow creating arbitrary commits and PRs, which is undesirable from a security standpoint.\nThis applies not only to tfaction but to any CI process that creates commits or PRs."]}),"\n",(0,i.jsx)(t.p,{children:"CSM Actions is an action that solves this problem by implementing a Client/Server Model in GitHub Actions."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://github.com/csm-actions/docs",children:"https://github.com/csm-actions/docs"})}),"\n",(0,i.jsxs)(t.p,{children:["tfaction natively supports CSM Actions, allowing you to create commits and PRs through it.\nBy adopting CSM Actions, you can revoke the ",(0,i.jsx)(t.code,{children:"contents:write"})," permission from ",(0,i.jsx)(t.code,{children:"github_token"})," (GitHub App)."]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"First, you need to set up the server-side GitHub Actions following the CSM Actions documentation."}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/csm-actions/securefix-action",children:"Securefix Action"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/csm-actions/update-branch-action",children:"Update Branch Action"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"At the same time, create the client-side GitHub App and register it in GitHub Secrets."}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsx)(t.li,{children:"Specify the CSM Actions server repository in tfaction-root.yaml."}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml:tfaction-root.yaml",children:"securefix_action:\n  server_repository: csm-actions-server\n  pull_request:\n    base_branch: main\n"})}),"\n",(0,i.jsxs)(t.ol,{start:"3",children:["\n",(0,i.jsx)(t.li,{children:"Pass the CSM Actions GitHub App ID and Private Key to the action."}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml:.github/workflows/test.yaml",children:"- uses: suzuki-shunsuke/tfaction@latest\n  with:\n    action: plan\n    github_token: ${{steps.generate_token.outputs.token}}\n    securefix_action_app_id: ${{vars.CSM_APP_ID}}\n    securefix_action_app_private_key: ${{secrets.CSM_APP_PRIVATE_KEY}}\n"})})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453(e,t,n){n.d(t,{R:()=>r,x:()=>c});var s=n(6540);const i={},o=s.createContext(i);function r(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);