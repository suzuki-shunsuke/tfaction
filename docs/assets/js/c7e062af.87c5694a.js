"use strict";(self.webpackChunktfaction=self.webpackChunktfaction||[]).push([[263],{5680:(e,t,n)=>{n.d(t,{xA:()=>l,yg:()=>y});var r=n(6540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},l=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,y=u["".concat(c,".").concat(m)]||u[m]||g[m]||s;return n?r.createElement(y,o(o({ref:t},l),{},{components:n})):r.createElement(y,o({ref:t},l))}));function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[u]="string"==typeof e?e:a,o[1]=i;for(var p=2;p<s;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2317:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>g,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var r=n(8168),a=(n(6540),n(5680));const s={sidebar_position:300},o="Secrets Management",i={unversionedId:"config/secret",id:"config/secret",title:"Secrets Management",description:"tfaction supports two types of secrets management.",source:"@site/docs/config/secret.md",sourceDirName:"config",slug:"/config/secret",permalink:"/tfaction/docs/config/secret",draft:!1,editUrl:"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/config/secret.md",tags:[],version:"current",sidebarPosition:300,frontMatter:{sidebar_position:300},sidebar:"tutorialSidebar",previous:{title:"aqua.yaml",permalink:"/tfaction/docs/config/aqua"},next:{title:"Set Terraform CLI options with the environment variable",permalink:"/tfaction/docs/config/terraform-cli-options"}},c={},p=[{value:"GitHub Secrets",id:"github-secrets",level:3},{value:"AWS Secrets Manager",id:"aws-secrets-manager",level:3}],l={toc:p},u="wrapper";function g(e){let{components:t,...n}=e;return(0,a.yg)(u,(0,r.A)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"secrets-management"},"Secrets Management"),(0,a.yg)("p",null,"tfaction supports two types of secrets management."),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://docs.github.com/en/actions/security-guides/encrypted-secrets"},"GitHub Secrets")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://aws.amazon.com/secrets-manager/"},"AWS Secrets Manager"))),(0,a.yg)("h3",{id:"github-secrets"},"GitHub Secrets"),(0,a.yg)("p",null,"You can export GitHub Secrets as environment variables with ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfaction/tree/main/export-secrets"},"export-secrets")," Action."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"- uses: suzuki-shunsuke/tfaction/export-secrets@main\n  with:\n    secrets: ${{ toJSON(secrets) }}\n")),(0,a.yg)("p",null,"Target Group Configuration"),(0,a.yg)("p",null,"e.g."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"target_groups:\n- working_directory: atlas/staging/\n  # ...\n  secrets:\n  # export the secret `ATLAS_API_KEY_STAGING` as the environment variable `ATLAS_API_KEY`\n  - env_name: ATLAS_API_KEY\n    secret_name: ATLAS_API_KEY_STAGING\n")),(0,a.yg)("p",null,"Job Configuration"),(0,a.yg)("p",null,"e.g."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"target_groups:\n- working_directory: atlas/staging/\n  # ...\n  terraform_plan_config:\n    # ...\n    secrets:\n    - env_name: ATLAS_API_KEY\n      secret_name: ATLAS_API_KEY_STAGING_READ_ONLY\n")),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"If secrets aren't set as you expect, please check if secrets are passed to this action properly.\nIf you use reusable workflows, maybe secrets aren't passed to the reusable workflow.\nIf so, please pass secrets properly."),(0,a.yg)("ul",{parentName:"admonition"},(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://docs.github.com/en/actions/using-workflows/reusing-workflows#passing-inputs-and-secrets-to-a-reusable-workflow"},"https://docs.github.com/en/actions/using-workflows/reusing-workflows#passing-inputs-and-secrets-to-a-reusable-workflow")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsecrets"},"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsecrets"))),(0,a.yg)("p",{parentName:"admonition"},"From tfaction v1.3.1, the action outputs the list of secrets passed to the action as a log.\nSo please check the log."),(0,a.yg)("p",{parentName:"admonition"},"e.g."),(0,a.yg)("pre",{parentName:"admonition"},(0,a.yg)("code",{parentName:"pre"},'Run suzuki-shunsuke/tfaction/export-secrets@v1.3.1\nThe list of secret names passed to the action: gh_app_id, gh_app_private_Key, github_token\nError: "secret is not found: FASTLY_API_KEY"\n'))),(0,a.yg)("h3",{id:"aws-secrets-manager"},"AWS Secrets Manager"),(0,a.yg)("p",null,"You can export AWS Secrets Manager's Secrets as environment variables with ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfaction/tree/main/export-aws-secrets-manager"},"export-aws-secrets-manager")," Action.\nThis action is used in ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/suzuki-shunsuke/tfaction/tree/main/setup"},"setup")," Action, so you don't have to use this Action explicitly."),(0,a.yg)("p",null,"Target Group Configuration"),(0,a.yg)("p",null,"e.g."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"target_groups:\n- working_directory: foo/\n  # ...\n  aws_secrets_manager:\n  - secret_id: foo\n    envs:\n    - env_name: FOO_API_KEY\n    # if `secret_key` isn't specified, the whole secret value is exported\n")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"target_groups:\n- working_directory: atlas/\n  # ...\n  aws_secrets_manager:\n  - secret_id: atlas\n    envs:\n    - env_name: ATLAS_API_PUBLIC_KEY\n      secret_key: public_key\n    - env_name: ATLAS_API_PRIVATE_KEY\n      secret_key: private_key\n      # if `secret_key` is specified, the secret value is treated as JSON and the specified key is exported\n")),(0,a.yg)("p",null,"Job Configuration"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-yaml"},"target_groups:\n- working_directory: atlas/\n  # ...\n  terraform_plan_config:\n    # ...\n    aws_secrets_manager:\n    - secret_id: atlas\n      envs:\n      - env_name: ATLAS_API_PUBLIC_KEY\n        secret_key: public_key\n      - env_name: ATLAS_API_PRIVATE_KEY\n        secret_key: private_key\n")))}g.isMDXComponent=!0}}]);