"use strict";(globalThis.webpackChunktfaction=globalThis.webpackChunktfaction||[]).push([[1739],{3998(o,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"unreleased/google-cloud","title":"Configuration for Google Cloud","description":"This page explains the configuration for using the Google Cloud Provider and GCS Backend.","source":"@site/docs/unreleased/google-cloud.md","sourceDirName":"unreleased","slug":"/unreleased/google-cloud","permalink":"/tfaction/docs/unreleased/google-cloud","draft":false,"unlisted":false,"editUrl":"https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/unreleased/google-cloud.md","tags":[],"version":"current","sidebarPosition":1400,"frontMatter":{"sidebar_position":1400},"sidebar":"tutorialSidebar","previous":{"title":"AWS Configuration","permalink":"/tfaction/docs/unreleased/aws"},"next":{"title":"Handling Secrets","permalink":"/tfaction/docs/unreleased/secret"}}');var r=t(4848),i=t(8453);const a={sidebar_position:1400},s="Configuration for Google Cloud",c={},l=[{value:"IAM Role Configuration",id:"iam-role-configuration",level:2},{value:"OIDC",id:"oidc",level:2}];function u(o){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...o.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"configuration-for-google-cloud",children:"Configuration for Google Cloud"})}),"\n",(0,r.jsx)(e.p,{children:"This page explains the configuration for using the Google Cloud Provider and GCS Backend.\nIf you do not use these, you can skip this page."}),"\n",(0,r.jsx)(e.p,{children:"When using these, you need to authenticate before running terraform init."}),"\n",(0,r.jsx)(e.h2,{id:"iam-role-configuration",children:"IAM Role Configuration"}),"\n",(0,r.jsx)(e.p,{children:"Configure the IAM Role to assume in tfaction-root.yaml or tfaction.yaml."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'target_groups:\n  - working_directory: ""\n    terraform_plan_config:\n      gcp_service_account: terraform-plan@gke-getting-started-277012.iam.gserviceaccount.com\n      gcp_workload_identity_provider: projects/750433540665/locations/global/workloadIdentityPools/my-pool/providers/github-actions-terraform-plan\n      gcp_access_token_scopes: "https://www.googleapis.com/auth/cloud-platform, https://www.googleapis.com/auth/userinfo.email, https://www.googleapis.com/auth/apps.groups.settings, https://www.googleapis.com/auth/admin.directory.group"\n    terraform_apply_config:\n      gcp_service_account: terraform-apply@gke-getting-started-277012.iam.gserviceaccount.com\n      gcp_workload_identity_provider: projects/750433540665/locations/global/workloadIdentityPools/my-pool/providers/github-actions-terraform-apply\n      gcp_access_token_scopes: "https://www.googleapis.com/auth/cloud-platform, https://www.googleapis.com/auth/userinfo.email, https://www.googleapis.com/auth/apps.groups.settings, https://www.googleapis.com/auth/admin.directory.group"\n'})}),"\n",(0,r.jsx)(e.p,{children:"Because you can use separate Service Accounts for terraform plan and apply, you can use a read-only Service Account for plan and a Service Account with stronger permissions for apply."}),"\n",(0,r.jsxs)(e.p,{children:["In tfaction v1, the ",(0,r.jsx)(e.code,{children:"setup"})," action executed ",(0,r.jsx)(e.a,{href:"https://github.com/google-github-actions/auth",children:"google-github-actions/auth"}),".\nStarting from v2, it is no longer executed automatically, so you need to run it yourself."]}),"\n",(0,r.jsx)(e.h2,{id:"oidc",children:"OIDC"}),"\n",(0,r.jsx)(e.p,{children:"You can assume a Service Account from GitHub Actions using OIDC.\nThis is not directly related to tfaction, so the details are omitted here."}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.a,{href:"https://docs.github.com/en/actions/how-tos/secure-your-work/security-harden-deployments/oidc-in-google-cloud-platform",children:"https://docs.github.com/en/actions/how-tos/secure-your-work/security-harden-deployments/oidc-in-google-cloud-platform"})})]})}function d(o={}){const{wrapper:e}={...(0,i.R)(),...o.components};return e?(0,r.jsx)(e,{...o,children:(0,r.jsx)(u,{...o})}):u(o)}},8453(o,e,t){t.d(e,{R:()=>a,x:()=>s});var n=t(6540);const r={},i=n.createContext(r);function a(o){const e=n.useContext(i);return n.useMemo(function(){return"function"==typeof o?o(e):{...e,...o}},[e,o])}function s(o){let e;return e=o.disableParentContext?"function"==typeof o.components?o.components(r):o.components||r:a(o.components),n.createElement(i.Provider,{value:e},o.children)}}}]);