<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-feature/drift-detection" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Drift Detection | tfaction</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://suzuki-shunsuke.github.io/tfaction/docs/feature/drift-detection"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Drift Detection | tfaction"><meta data-rh="true" name="description" content="Check the drift periodically and track it using GitHub Issues"><meta data-rh="true" property="og:description" content="Check the drift periodically and track it using GitHub Issues"><link data-rh="true" rel="canonical" href="https://suzuki-shunsuke.github.io/tfaction/docs/feature/drift-detection"><link data-rh="true" rel="alternate" href="https://suzuki-shunsuke.github.io/tfaction/docs/feature/drift-detection" hreflang="en"><link data-rh="true" rel="alternate" href="https://suzuki-shunsuke.github.io/tfaction/docs/feature/drift-detection" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://LUUUGNZT4I-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="tfaction" href="/tfaction/docs/opensearch.xml"><link rel="stylesheet" href="/tfaction/docs/assets/css/styles.34e00838.css">
<script src="/tfaction/docs/assets/js/runtime~main.14bf8dc2.js" defer="defer"></script>
<script src="/tfaction/docs/assets/js/main.c071f25d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tfaction/docs/"><b class="navbar__title text--truncate">tfaction</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/suzuki-shunsuke/tfaction" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tfaction/docs/">tfaction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/tfaction/docs/feature/build-matrix">Feature</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/build-matrix">Support Monorepo with GitHub Actions build matrix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/tfcmt">Notify the result of terraform plan and apply with tfcmt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/plan-file">Apply safely with Terraform Plan File</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/auto-update-related-prs">Automatically update related pull requests when the remote state is updated</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/follow-up-pr">Create a pull request automatically to handle the problem when apply failed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/renovate">Update dependencies with Renovate safely</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/scaffold-working-dir">Scaffold working directory by GitHub Actions workflow_dispatch event</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/tfmigrate">tfmigrate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/module">Manage Terraform Modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/conftest">Conftest</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/support-skipping-terraform-renovate-pr">Support skipping terraform plan and terraform apply in case of pull request by Renovate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/auto-fix">Auto Fix .terraform.lock.hcl and Terraform Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tfaction/docs/feature/drift-detection">Drift Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/linter">Linters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/skip-creating-pr">Support skipping creating pull requests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/destroy">Destroy resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/use-terraform-compatible-tool">Use a Terraform compatible tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/local-path-module">Run CI on working directories that depend on a updated local path Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/generate-config-out">Generate code by terraform plan -generate-config-out</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/terraform-docs">Generate document using terraform-docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/debug-mode">Debug Mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/provider-dep">Check provider version constraint for troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tfaction/docs/feature/follow-up-pr-group-label">Follow-up PR Group Labels</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tfaction/docs/config/">Config</a><button aria-label="Expand sidebar category &#x27;Config&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/tfaction/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Feature</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Drift Detection</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Drift Detection</h1></header>
<p><em>Check the drift periodically and track it using GitHub Issues</em></p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/13323303/233079963-68765f2e-1efd-4278-b6c3-145eae9ef9c0.png" alt="image" class="img_ev3q"></p>
<p>tfaction &gt;= v0.6.0</p>
<p><a href="https://github.com/suzuki-shunsuke/tfaction/issues/851" target="_blank" rel="noopener noreferrer">#851</a> <a href="https://github.com/suzuki-shunsuke/tfaction/pull/876" target="_blank" rel="noopener noreferrer">#876</a></p>
<p>Blogs:</p>
<ul>
<li><a href="https://zenn.dev/shunsuke_suzuki/articles/tfaction-drift-detection" target="_blank" rel="noopener noreferrer">2023-06-05 tfaction による Terraform の Drift Detection</a></li>
<li><a href="https://dev.to/suzukishunsuke/terraforms-drift-detection-by-tfaction-1dkh" target="_blank" rel="noopener noreferrer">2023-06-05 Terraform&#x27;s Drift Detection by tfaction</a></li>
</ul>
<p>Drift Detection is the feature to detect <code>drift</code>. You can track the drift using GitHub Issues and resolve the drift continuously.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>This feature detects <code>drift</code> but doesn&#x27;t resolve it automatically. You have to resolve it yourself.</p></div></div>
<p>This feature is disabled by default. To enable this feature, please see <a href="#setup">Set up</a>.</p>
<p>tfaction creates GitHub Issues per working directory and manages each working directory&#x27;s drift with GitHub Issues.</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/13323303/232356635-0772278e-fc07-4cb2-a48e-a0e97c1cfd10.png" alt="image" class="img_ev3q"></p>
<p>tfaction opens an Issue when a drift is detected, and closes the Issue when the drift is resolved.</p>
<p>tfaction creates only one Issue per working directory and reuses the same issue.
If <code>drift</code> is detected again after <code>drift</code> is resolved once, tfaction reopens the same issue instead of creating a new issue.</p>
<p>tfaction checks if the drift exists at the following timing.</p>
<ol>
<li>A pull request is merged and <code>terraform apply</code> or <code>tfmigrate apply</code> are run</li>
<li><code>terraform plan</code> is run periodically by a dedicated GitHub Actions Workflow</li>
</ol>
<p>The result of <code>terraform apply</code>, <code>tfmigrate apply</code>, or <code>terraform plan</code> is posted to the issue. The comment has links to the GitHub Actions Workflow and the pull request.</p>
<p>e.g. An Issue was opened because <code>terraform apply</code> failed.</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/13323303/233077124-4db0f8a5-1f82-4abd-b0b4-fb641fcee85e.png" alt="image" class="img_ev3q"></p>
<p>e.g. An Issue was closed because <code>terraform apply</code> succeeded and the drift was resolved.</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/13323303/232356803-e1c7298f-362c-4f00-96f0-20f2ac8720f7.png" alt="image" class="img_ev3q"></p>
<p>e.g. Drift is checked periodically.</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/13323303/233079030-67bd01cc-b6bf-425a-bdeb-82447a31904a.png" alt="image" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/13323303/233079963-68765f2e-1efd-4278-b6c3-145eae9ef9c0.png" alt="image" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2>
<ul>
<li>tfaction &gt;= v0.6.0</li>
<li>tfaction-go &gt;= v0.1.2</li>
<li><strong>github-comment &gt;= v5.2.1</strong></li>
<li><strong>tfcmt &gt;= v4.3.0</strong></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="set-up">Set up<a href="#set-up" class="hash-link" aria-label="Direct link to Set up" title="Direct link to Set up">​</a></h2>
<ol>
<li>Update tfaciton-root.yaml</li>
<li>Install tfaction-go by aqua</li>
<li>Add two GitHub Actions workflows</li>
<li>Update the apply workflow</li>
<li>Run <code>schedule-create-drift-issues.yaml</code> manually only once</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-update-tfaciton-rootyaml">1. Update tfaciton-root.yaml<a href="#1-update-tfaciton-rootyaml" class="hash-link" aria-label="Direct link to 1. Update tfaciton-root.yaml" title="Direct link to 1. Update tfaciton-root.yaml">​</a></h3>
<p>Please configure Drift Detection.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">drift_detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Enable Drift Detection with the default settings</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">drift_detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">issue_repo_owner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> suzuki</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shunsuke </span><span class="token comment" style="color:#999988;font-style:italic"># Repository owner of GitHub Issues. By default, Repository where GitHub Actions is run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">issue_repo_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tfaction</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example </span><span class="token comment" style="color:#999988;font-style:italic"># Repository name of GitHub Issues. By default, Repository where GitHub Actions is run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">num_of_issues</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The number of issues that scheduled job handles. The default value is `1`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minimum_detection_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The default value is 168 (7 days). The scheduled workflow picks out working directories whose issues were updated before `minimum_detection_interval` hours</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By default, drift issues are created in the same repository where tfaction is run.
If you change the repository, you have to use GitHub App token or personal access token instead of GitHub Actions token because GitHub Actions token can&#x27;t access the other repository.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-install-tfaction-go-by-aqua">2. Install tfaction-go by aqua<a href="#2-install-tfaction-go-by-aqua" class="hash-link" aria-label="Direct link to 2. Install tfaction-go by aqua" title="Direct link to 2. Install tfaction-go by aqua">​</a></h3>
<p>Please install <a href="https://github.com/suzuki-shunsuke/tfaction-go" target="_blank" rel="noopener noreferrer">tfaction-go</a> in the repository root <code>aqua.yaml</code>.</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ aqua g -i suzuki-shunsuke/tfaction-go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-add-two-github-actions-workflows">3. Add two GitHub Actions workflows<a href="#3-add-two-github-actions-workflows" class="hash-link" aria-label="Direct link to 3. Add two GitHub Actions workflows" title="Direct link to 3. Add two GitHub Actions workflows">​</a></h3>
<p>Please run these workflows periodically.</p>
<ol>
<li><a href="https://github.com/suzuki-shunsuke/tfaction-example/blob/main/.github/workflows/schedule-create-drift-issues.yaml" target="_blank" rel="noopener noreferrer">schedule-create-drift-issues.yaml</a>: Create Drift Issues periodically</li>
<li><a href="https://github.com/suzuki-shunsuke/tfaction-example/blob/main/.github/workflows/schedule-detect-drifts.yaml" target="_blank" rel="noopener noreferrer">schedule-detect-drifts.yaml</a>: Test if each working directory has a drift periodically</li>
<li>(Optional) <a href="https://github.com/suzuki-shunsuke/tfaction-example/blob/main/.github/workflows/sync-drift-issue-description.yaml" target="_blank" rel="noopener noreferrer">sync-drift-issue-description.yaml</a>: Synchronize Drift Issue&#x27;s description with the latest issue comment</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-schedule-create-drift-issuesyaml">3.1. schedule-create-drift-issues.yaml<a href="#31-schedule-create-drift-issuesyaml" class="hash-link" aria-label="Direct link to 3.1. schedule-create-drift-issues.yaml" title="Direct link to 3.1. schedule-create-drift-issues.yaml">​</a></h4>
<ol>
<li>Create Issues</li>
<li>Archive Issues whose working directories are not found</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>This workflow closes issues immediately because drift detection isn&#x27;t run against those working directories when issues are created.
Issues will be reopened when the drift will be detected.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="32-schedule-detect-driftsyaml">3.2. schedule-detect-drifts.yaml<a href="#32-schedule-detect-driftsyaml" class="hash-link" aria-label="Direct link to 3.2. schedule-detect-drifts.yaml" title="Direct link to 3.2. schedule-detect-drifts.yaml">​</a></h4>
<ol>
<li>Pick out some Issues not checked recently and check the drift and updates Issues</li>
<li>Archive Issues whose working directories are not found</li>
</ol>
<p><code>tfaction-root.yaml</code>&#x27;s following settings affect the workflow.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">drift_detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">num_of_issues</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The maximum number of issues that scheduled job handles. The default value is `1`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minimum_detection_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># The default value is 168 (7 days). The scheduled workflow picks out working directories whose issues were updated before `minimum_detection_interval` hours</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This workflow picks out at most <code>num_of_issues</code> working directories whose issues were updated before <code>minimum_detection_interval</code> hours and checks if they have drifts.</p>
<p>The pseudo query to pick out issues is like the following.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">repo:${repo} &quot;Terraform Drift&quot; in:title sort:updated-asc updated:&lt;${now - minimum_detection_interval(hour)}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means if all drift issues were updated within <code>minimum_detection_interval</code> hours from now, no working directory aren&#x27;t picked out.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Why is the parameter <code>minimum_detection_interval</code> needed?
That is because the drift is checked by not only scheduled workflow but also apply workflow.
If the apply workflow is run recently against a working directory, the scheduled workflow doesn&#x27;t have to check the same working directory.
So tfaction updates drift issues by not only the scheduled workflow but also the apply workflow, and restricts the target of the scheduled workflow by issue&#x27;s last updated time and <code>minimum_detection_interval</code>.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="33-sync-drift-issue-descriptionyaml">3.3. sync-drift-issue-description.yaml<a href="#33-sync-drift-issue-descriptionyaml" class="hash-link" aria-label="Direct link to 3.3. sync-drift-issue-description.yaml" title="Direct link to 3.3. sync-drift-issue-description.yaml">​</a></h4>
<p>If you want to reflect the latest drift detection&#x27;s result to drift issue&#x27;s description, please add the workflow to the repository drift issues are created.</p>
<p><a href="https://github.com/suzuki-shunsuke/tfaction-example/blob/main/.github/workflows/sync-drift-issue-description.yaml" target="_blank" rel="noopener noreferrer">sync-drift-issue-description.yaml</a> <!-- -->⚠️<!-- --> Please change <code>github.actor</code> properly</p>
<p>This workflow is optional.</p>
<p><img decoding="async" loading="lazy" src="https://github.com/suzuki-shunsuke/tfaction-docs/assets/13323303/2e95f528-8c5d-410c-8dec-fe0dabd3e85a" alt="image" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-update-the-apply-workflow">4. Update the apply workflow<a href="#4-update-the-apply-workflow" class="hash-link" aria-label="Direct link to 4. Update the apply workflow" title="Direct link to 4. Update the apply workflow">​</a></h3>
<p>Please add some steps to <code>terraform-apply</code> and <code>tfmigrate-apply</code> jobs.</p>
<ol>
<li>Run <code>tfaction get-or-create-drift-issue</code> before <code>tfaction/setup</code></li>
</ol>
<p><a href="https://github.com/suzuki-shunsuke/tfaction-example/blob/e8688924120f65c48839850a980feb241ac80dd8/.github/workflows/apply.yaml#L65-L68" target="_blank" rel="noopener noreferrer">example</a></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tfaction get</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">or</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">create</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">drift</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">issue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">shell</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">GITHUB_TOKEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.token </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> suzuki</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shunsuke/tfaction/setup@v0.6.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This step gets a drift issue for the working directory.
If a drift issue isn&#x27;t found, a new issue is created.
The environment variables about the drift issue are set.</p>
<ol start="2">
<li>Run <code>tfaction/update-drift-issue</code> in the end of the jobs. Set <code>if: always()</code> to run the step definitely.</li>
</ol>
<p><a href="https://github.com/suzuki-shunsuke/tfaction-example/blob/e8688924120f65c48839850a980feb241ac80dd8/.github/workflows/apply.yaml#L84-L88" target="_blank" rel="noopener noreferrer">example</a></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> suzuki</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shunsuke/tfaction/update</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">drift</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">issue@v0.6.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">job.status</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">github_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">steps.generate_token.outputs.token</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This step closes or reopens the drift issue according to the job result.
If the job fails the issue is reopened. Or if the job succeeds the issue is closed.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>You have to update tfaction of all steps to v0.6.0 or later. If old tfaction is used in other steps drift detection doesn&#x27;t work well.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-run-schedule-create-drift-issuesyaml-manually-only-once">5. Run <code>schedule-create-drift-issues.yaml</code> manually only once<a href="#5-run-schedule-create-drift-issuesyaml-manually-only-once" class="hash-link" aria-label="Direct link to 5-run-schedule-create-drift-issuesyaml-manually-only-once" title="Direct link to 5-run-schedule-create-drift-issuesyaml-manually-only-once">​</a></h3>
<p>Drift Detection doesn&#x27;t work well if GitHub Issues don&#x27;t exist. So please run the workflow manually to create issues only once.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-drift-detection-against-only-specific-working-directories">Enable drift detection against only specific working directories<a href="#enable-drift-detection-against-only-specific-working-directories" class="hash-link" aria-label="Direct link to Enable drift detection against only specific working directories" title="Direct link to Enable drift detection against only specific working directories">​</a></h2>
<p>By default Drift Detection is enabled against all working directories, but you can enable Drift Detection against only specific working directories.</p>
<p>The priority is as following.</p>
<ol>
<li>tfaction.yaml&#x27;s <code>drift_detection</code></li>
<li>target group&#x27;s <code>drift_detection</code></li>
<li>tfaction-root.yaml&#x27;s <code>drift_detection</code></li>
</ol>
<p>e.g.</p>
<p>tfaction-root.yaml</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">drift_detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">target_groups</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">working_directory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aws/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">drift_detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>tfaction.yaml</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">drift_detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-access-token">GitHub Access Token<a href="#github-access-token" class="hash-link" aria-label="Direct link to GitHub Access Token" title="Direct link to GitHub Access Token">​</a></h2>
<p>The permission <code>issues: write</code> is required to update GitHub Issues.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-issues-title">GitHub Issue&#x27;s title<a href="#github-issues-title" class="hash-link" aria-label="Direct link to GitHub Issue&#x27;s title" title="Direct link to GitHub Issue&#x27;s title">​</a></h2>
<p>Please don&#x27;t change GitHub Issue&#x27;s title basically because tfaction identifies issues using the title.
The title must be unique.</p>
<p>If you change a target name of a working directory and you want to keep using the same drift issue,
please change the issue title properly. Otherwise, tfaction will close the issue and create a new issue.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="adjust-the-frequency-of-drift-detection">Adjust the frequency of Drift Detection<a href="#adjust-the-frequency-of-drift-detection" class="hash-link" aria-label="Direct link to Adjust the frequency of Drift Detection" title="Direct link to Adjust the frequency of Drift Detection">​</a></h2>
<p>Please adjust the frequency of Drift Detection as you like.</p>
<ul>
<li>The schedule of GitHub Actions Workflow</li>
<li>Drift Detection&#x27;s configuration<!-- -->
<ul>
<li>num_of_issues</li>
<li>minimum_detection_interval</li>
</ul>
</li>
</ul>
<p>This depends on the number of working directories. Please pay attention to the cost and API rate limiting if you increase the frequency.</p>
<p>The following table shows the example.</p>
<table><thead><tr><th>No.</th><th>the number of working directory</th><th>frequency of workflow</th><th><code>num_of_issues</code></th><th>frequency per working directory (/ 1 times)</th></tr></thead><tbody><tr><td>1</td><td>10</td><td>1 / hour</td><td>1</td><td>10 hour</td></tr><tr><td>2</td><td>7</td><td>1 / day</td><td>1</td><td>1 week</td></tr><tr><td>3</td><td>1000</td><td>1 / 30 min</td><td>3</td><td>1 week</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-handle-issues">How to handle issues<a href="#how-to-handle-issues" class="hash-link" aria-label="Direct link to How to handle issues" title="Direct link to How to handle issues">​</a></h2>
<p>Even if issues are created by Drift Detection,
there is no meaning if you don&#x27;t resolve them.</p>
<p>How to use this feature is completely up to you, but we have some advice.</p>
<ul>
<li>Don&#x27;t handle all issues by only you. Handle issues by teams</li>
<li>Create a strategy to handle issues continuously</li>
<li>Create rules to handle issues and write a guide so that everyone can handle issues properly</li>
<li>Rotate person in charge of handling issues</li>
<li>Leave the issue handling to each working directory&#x27;s owners</li>
<li>Review and improve the issue handling periodically</li>
</ul>
<p>The real time notification to the chat tool may be noisy and exhaust you, so we recommend making the time to check issues periodically (e.g. daily or weekly) rather than the real time notification.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-save-cost-">How to save cost 💰<a href="#how-to-save-cost-" class="hash-link" aria-label="Direct link to How to save cost 💰" title="Direct link to How to save cost 💰">​</a></h2>
<p>If you want to save cost, there are some options.</p>
<ol>
<li>Decrease the frequency of <code>schedule-detect-drifts</code> workflow</li>
<li>Stop running <code>schedule-detect-drifts</code> workflow. Even if <code>schedule-detect-drifts</code> is stopped, drift issues are updated according to the result of <code>terraform apply</code> and <code>tfmigrate apply</code>. Maybe this is enough useful</li>
<li>Use GitHub Actions Self hosted runner</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/suzuki-shunsuke/tfaction-docs/edit/main/docs/feature/drift-detection.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/tfaction/docs/feature/auto-fix"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Auto Fix .terraform.lock.hcl and Terraform Configuration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tfaction/docs/feature/linter"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Linters</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#set-up" class="table-of-contents__link toc-highlight">Set up</a><ul><li><a href="#1-update-tfaciton-rootyaml" class="table-of-contents__link toc-highlight">1. Update tfaciton-root.yaml</a></li><li><a href="#2-install-tfaction-go-by-aqua" class="table-of-contents__link toc-highlight">2. Install tfaction-go by aqua</a></li><li><a href="#3-add-two-github-actions-workflows" class="table-of-contents__link toc-highlight">3. Add two GitHub Actions workflows</a></li><li><a href="#4-update-the-apply-workflow" class="table-of-contents__link toc-highlight">4. Update the apply workflow</a></li><li><a href="#5-run-schedule-create-drift-issuesyaml-manually-only-once" class="table-of-contents__link toc-highlight">5. Run <code>schedule-create-drift-issues.yaml</code> manually only once</a></li></ul></li><li><a href="#enable-drift-detection-against-only-specific-working-directories" class="table-of-contents__link toc-highlight">Enable drift detection against only specific working directories</a></li><li><a href="#github-access-token" class="table-of-contents__link toc-highlight">GitHub Access Token</a></li><li><a href="#github-issues-title" class="table-of-contents__link toc-highlight">GitHub Issue&#39;s title</a></li><li><a href="#adjust-the-frequency-of-drift-detection" class="table-of-contents__link toc-highlight">Adjust the frequency of Drift Detection</a></li><li><a href="#how-to-handle-issues" class="table-of-contents__link toc-highlight">How to handle issues</a></li><li><a href="#how-to-save-cost-" class="table-of-contents__link toc-highlight">How to save cost 💰</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/suzuki-shunsuke/tfaction" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Shunsuke Suzuki. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>